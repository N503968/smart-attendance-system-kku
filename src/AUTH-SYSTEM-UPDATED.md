# โ ุชุญุฏูุซ ูุธุงู ุชุณุฌูู ุงูุฏุฎูู ูุงูุชุณุฌูู - Auth System Update

<div align="center">

# ๐ **ุงูุงุชุตุงู ุงููุนูู ูุน Supabase**

**ุชู ุชุญุฏูุซ ุงููุธุงู ููุณุชุฎุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุญููููุฉ ุจุฏูุงู ูู Mock Data**

</div>

---

## ๐ **ููุฎุต ุงูุชุญุฏูุซุงุช:**

### โ **ูุง ุชู ุชูููุฐู:**

1. โ **ุฑุจุท ูุนูู ูุน Supabase Auth** - ุงุณุชุฎุฏุงู `signInWithPassword` ู `signUp`
2. โ **ุงูุชุญูู ูู ุงูุจุฑูุฏ ุงูุฌุงูุนู** - ูุฌุจ ุฃู ููุชูู ุจู `@kku.edu.sa`
3. โ **ุชุญุฏูุซ ุงูุฃุฏูุงุฑ** - `student`, `teacher`, `supervisor`
4. โ **ุงูุฑูู ุงูุฌุงูุนู ุฅูุฒุงูู ููุทูุงุจ** - validation ูุงูู
5. โ **ุญูุธ ุงูุจูุงูุงุช ูู ุฌุฏูู profiles** - ุชููุงุฆูุงู ุจุนุฏ ุงูุชุณุฌูู
6. โ **ุงูุชูุฌูู ุงูุชููุงุฆู ุญุณุจ ุงูุฏูุฑ** - ูู ูุณุชุฎุฏู ูุฐูุจ ูููุญุฉ ุงูุชุญูู ุงูุฎุงุตุฉ ุจู
7. โ **ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ** - ุจุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
8. โ **ุชูุจููุงุช ูููุณุชุฎุฏู** - ุฅุฐุง ูุงู ุงูุจุฑูุฏ ุบูุฑ ุฌุงูุนู

---

## ๐ **ุงูุชุบููุฑุงุช ุงูุชูุตูููุฉ:**

### 1๏ธโฃ **AuthPage.tsx**

#### โจ **ุงูุชุณุฌูู ุงูุฌุฏูุฏ (Sign Up):**

```typescript
// ุงูุชุญูู ูู ุงูุจุฑูุฏ ุงูุฌุงูุนู
if (!registerEmail.toLowerCase().endsWith('@kku.edu.sa')) {
  toast.error('โ๏ธ ูุฌุจ ุงุณุชุฎุฏุงู ุงูุจุฑูุฏ ุงูุฌุงูุนู (@kku.edu.sa) ููุท');
  return;
}

// ุงูุชุญูู ูู ุงูุฑูู ุงูุฌุงูุนู ููุทูุงุจ
if (registerRole === 'student' && !registerStudentNumber.trim()) {
  toast.error('โ๏ธ ุงูุฑูู ุงูุฌุงูุนู ูุทููุจ ููุทูุงุจ');
  return;
}

// ุฅูุดุงุก ุญุณุงุจ ูู Supabase
const { data: authData, error: authError } = await supabase.auth.signUp({
  email: registerEmail,
  password: registerPassword,
  options: {
    data: {
      full_name: registerFullName,
      role: registerRole,
      student_number: registerRole === 'student' ? registerStudentNumber : null,
    },
  },
});

// ุญูุธ ุงูุจูุงูุงุช ูู ุฌุฏูู profiles
const { error: profileError } = await supabase.from('profiles').insert({
  id: authData.user.id,
  full_name: registerFullName,
  email: registerEmail,
  role: registerRole,
  student_number: registerRole === 'student' ? registerStudentNumber : null,
});
```

#### โจ **ุชุณุฌูู ุงูุฏุฎูู (Sign In):**

```typescript
// ุชุณุฌูู ุงูุฏุฎูู ูุน Supabase
const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
  email: loginEmail,
  password: loginPassword,
});

// ุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู ูู ุฌุฏูู profiles
const { data: profile, error: profileError } = await supabase
  .from('profiles')
  .select('*')
  .eq('id', authData.user.id)
  .single();

// ุชูุฑูุฑ ุงูุจูุงูุงุช ููุชุทุจูู
onLogin(profile);
```

#### โจ **ุงูุชุญุฏูุซุงุช ูู ุงููุงุฌูุฉ:**

- ุฅุถุงูุฉ ุชูุจูู ูุงุถุญ ุจุฃู ุงูุจุฑูุฏ ุงูุฌุงูุนู ูุทููุจ
- ุฌุนู ุงูุฑูู ุงูุฌุงูุนู **ุฅูุฒุงูู** ููุทูุงุจ (required field)
- ุชุญุฏูุซ placeholder ููุจุฑูุฏ ุงูุฅููุชุฑููู
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุตูุฉ

---

### 2๏ธโฃ **lib/supabase.ts**

#### โจ **ุชุญุฏูุซ ุงูุฃููุงุน (Types):**

```typescript
// ุงูุฃุฏูุงุฑ ุงูุฌุฏูุฏุฉ
export type UserRole = 'supervisor' | 'teacher' | 'student';

// ูุงุฌูุฉ Profile
export interface Profile {
  id: string;
  full_name: string;
  email: string;
  role: UserRole;
  student_number?: string;  // ุงุฎุชูุงุฑู ูููุฏุฑุณูู ูุงููุดุฑููู
  created_at?: string;
}
```

---

### 3๏ธโฃ **App.tsx**

#### โจ **ุงูุชูุฌูู ุญุณุจ ุงูุฏูุฑ:**

```typescript
case 'dashboard':
  if (currentUser.role === 'supervisor') {
    return <AdminDashboard ... />;
  } else if (currentUser.role === 'teacher') {
    return <InstructorDashboard ... />;
  } else if (currentUser.role === 'student') {
    return <StudentDashboard ... />;
  }
```

#### โจ **ุงูุชุญูู ุจุงููุตูู:**

```typescript
// ููุท ุงููุฏุฑุณูู ูููููู ุฅูุดุงุก ุฌูุณุงุช
case 'create-session':
  if (currentUser.role === 'teacher') {
    return <CreateSessionPage ... />;
  }

// ููุท ุงูุทูุงุจ ูููููู ุชุณุฌูู ุงูุญุถูุฑ
case 'submit-attendance':
  if (currentUser.role === 'student') {
    return <SubmitAttendancePage ... />;
  }

// ููุท ุงููุดุฑููู ูููููู ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
case 'users':
  if (currentUser.role === 'supervisor') {
    return <UsersPage ... />;
  }
```

---

## ๐ **ุงูุฃุฏูุงุฑ ููุณุคูููุงุชูุง:**

### ๐จโ๐ **Student (ุทุงูุจ):**

```
โ ุนุฑุถ ุงูุฌุฏูู ุงููููู
โ ุชุณุฌูู ุงูุญุถูุฑ (Code/QR/Biometric)
โ ูุชุงุจุนุฉ ุงูุณุฌู ุงูุดุฎุตู
โ ุนุฑุถ ุงูุชูุงุฑูุฑ ุงูุดุฎุตูุฉ
โ๏ธ ุงูุฑูู ุงูุฌุงูุนู ุฅูุฒุงูู
โ๏ธ ุงูุจุฑูุฏ ูุฌุจ ุฃู ููุชูู ุจู @kku.edu.sa
```

### ๐จโ๐ซ **Teacher (ูุฏุฑุณ):**

```
โ ุฅูุดุงุก ุฌูุณุงุช ุญุถูุฑ
โ ุนุฑุถ ุงูููุฑุฑุงุช ุงููุฎุตุตุฉ
โ ุชูุงุฑูุฑ ุงูุญุถูุฑ ุงููุงุจูุฉ ููุชุตุฏูุฑ
โ ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช ูุงูุดุนุจ
โ๏ธ ุงูุจุฑูุฏ ูุฌุจ ุฃู ููุชูู ุจู @kku.edu.sa
```

### ๐ค **Supervisor (ูุดุฑู):**

```
โ ุฅุญุตุงุฆูุงุช ุดุงููุฉ
โ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
โ ุฅุฏุงุฑุฉ ุงูููุงุฏ ูุงูุฃูุณุงู
โ ุนุฑุถ ุฌููุน ุงูุชูุงุฑูุฑ
โ๏ธ ุงูุจุฑูุฏ ูุฌุจ ุฃู ููุชูู ุจู @kku.edu.sa
```

---

## ๐ **ูุธุงู ุงูุญูุงูุฉ:**

### โ **ุงูุชุญูู ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:**

```typescript
// ูุฌุจ ุฃู ููุชูู ุจู @kku.edu.sa
if (!registerEmail.toLowerCase().endsWith('@kku.edu.sa')) {
  // ุฑูุถ ุงูุชุณุฌูู
}
```

### โ **ุงูุชุญูู ูู ุงูุฑูู ุงูุฌุงูุนู:**

```typescript
// ููุทูุงุจ ููุท
if (registerRole === 'student' && !registerStudentNumber.trim()) {
  // ุฑูุถ ุงูุชุณุฌูู
}
```

### โ **ุญูุงูุฉ ุงูุตูุญุงุช:**

```typescript
// ูู ุตูุญุฉ ูุญููุฉ ุญุณุจ ุงูุฏูุฑ
if (currentUser.role !== 'teacher') {
  // ุนุฑุถ ุฑุณุงูุฉ Access Denied
  // ุฅุนุงุฏุฉ ุงูุชูุฌูู ูููุญุฉ ุงูุชุญูู
}
```

---

## ๐งช **ููููุฉ ุงูุงุฎุชุจุงุฑ:**

### 1๏ธโฃ **ุงุฎุชุจุงุฑ ุงูุชุณุฌูู:**

```bash
# ููุทุงูุจ:
ุงูุงุณู ุงููุงูู: ุฃุญูุฏ ูุญูุฏ
ุงูุจุฑูุฏ: ahmed@kku.edu.sa
ุงูุฏูุฑ: ุทุงูุจ
ุงูุฑูู ุงูุฌุงูุนู: 443816488
ูููุฉ ุงููุฑูุฑ: Test123!

# ูููุฏุฑุณ:
ุงูุงุณู ุงููุงูู: ุฏ. ุณุงุฑุฉ ุฃุญูุฏ
ุงูุจุฑูุฏ: sara@kku.edu.sa
ุงูุฏูุฑ: ูุฏุฑุณ
ูููุฉ ุงููุฑูุฑ: Test123!

# ูููุดุฑู:
ุงูุงุณู ุงููุงูู: ุฏ. ูุญูุฏ ุนูู
ุงูุจุฑูุฏ: mohammed@kku.edu.sa
ุงูุฏูุฑ: ูุดุฑู
ูููุฉ ุงููุฑูุฑ: Test123!
```

### 2๏ธโฃ **ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู:**

```bash
# ุงุณุชุฎุฏู ุฃุญุฏ ุงูุญุณุงุจุงุช ุงููุณุฌูุฉ
ุงูุจุฑูุฏ: ahmed@kku.edu.sa
ูููุฉ ุงููุฑูุฑ: Test123!

# ุงููุชูุฌุฉ ุงููุชููุนุฉ:
โ ุชุณุฌูู ุฏุฎูู ูุงุฌุญ
โ ุงูุงูุชูุงู ูููุญุฉ ุงูุชุญูู ุญุณุจ ุงูุฏูุฑ
โ ุนุฑุถ ุงุณู ุงููุณุชุฎุฏู ูู Navbar
```

### 3๏ธโฃ **ุงุฎุชุจุงุฑ ุงูุชุญูู ูู ุงูุจุฑูุฏ:**

```bash
# ูุญุงููุฉ ุงุณุชุฎุฏุงู ุจุฑูุฏ ุบูุฑ ุฌุงูุนู
ุงูุจุฑูุฏ: test@gmail.com  โ
ุงููุชูุฌุฉ: ุฑูุถ ุงูุชุณุฌูู ูุน ุฑุณุงูุฉ ุฎุทุฃ

ุงูุจุฑูุฏ: test@kku.edu.sa  โ
ุงููุชูุฌุฉ: ูุจูู ุงูุชุณุฌูู
```

### 4๏ธโฃ **ุงุฎุชุจุงุฑ ุงูุฑูู ุงูุฌุงูุนู:**

```bash
# ููุทุงูุจ ุจุฏูู ุฑูู ุฌุงูุนู
ุงูุฏูุฑ: ุทุงูุจ
ุงูุฑูู ุงูุฌุงูุนู: (ูุงุฑุบ)  โ
ุงููุชูุฌุฉ: ุฑูุถ ุงูุชุณุฌูู ูุน ุฑุณุงูุฉ ุฎุทุฃ

ุงูุฑูู ุงูุฌุงูุนู: 443816488  โ
ุงููุชูุฌุฉ: ูุจูู ุงูุชุณุฌูู
```

---

## ๐ **ุฑุณุงุฆู ุงูุฎุทุฃ:**

### ุจุงูุนุฑุจูุฉ:

```
โ ูุฌุจ ุงุณุชุฎุฏุงู ุงูุจุฑูุฏ ุงูุฌุงูุนู (@kku.edu.sa) ููุท
โ ุงูุฑูู ุงูุฌุงูุนู ูุทููุจ ููุทูุงุจ
โ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฃู ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ
โ ูุฐุง ุงูุจุฑูุฏ ูุณุฌู ูุณุจูุงู
โ ูููุฉ ุงููุฑูุฑ ูุฌุจ ุฃู ุชููู 6 ุฃุญุฑู ุนูู ุงูุฃูู
โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ุฌุงูุฒุฉ - ุฑุงุฌุน /DO-THIS-NOW.md
```

### ุจุงูุฅูุฌููุฒูุฉ:

```
โ Only KKU email addresses (@kku.edu.sa) are allowed
โ Student number is required for students
โ Invalid email or password
โ Email already registered
โ Password must be at least 6 characters
โ Database not ready - See /DO-THIS-NOW.md
```

---

## ๐ง **ุงุณุชูุดุงู ุงูุฃุฎุทุงุก:**

### โ ุฎุทุฃ: "Email not confirmed"

```
ุงูุญู:
1. ุงูุชุญ: https://supabase.com/dashboard/project/bscxhshnubkhngodruuj/settings/auth
2. ุงุจุญุซ ุนู: "Enable email confirmations"
3. ุงุทูุฆู (OFF)
4. ุงุญูุธ

๐ ุฑุงุฌุน: /โ๏ธ-FIX-THIS-FIRST.md
```

### โ ุฎุทุฃ: "Could not find table 'public.profiles'"

```
ุงูุญู:
1. ุงูุชุญ: https://supabase.com/dashboard/project/bscxhshnubkhngodruuj/sql
2. ุงูุชุญ ููู: /supabase-schema.sql
3. ุงูุณุฎ ูู ุงููุญุชูู
4. ุงูุตู ูู SQL Editor
5. ุงุถุบุท Run

๐ ุฑุงุฌุน: /DO-THIS-NOW.md
```

### โ ุฎุทุฃ: "Only KKU email addresses are allowed"

```
ุงูุณุจุจ: ุงูุจุฑูุฏ ุงููุณุชุฎุฏู ูุง ููุชูู ุจู @kku.edu.sa

ุงูุญู:
ุงุณุชุฎุฏู ุจุฑูุฏ ุฌุงูุนู ุตุญูุญ:
โ yourname@kku.edu.sa
โ yourname@gmail.com
```

### โ ุฎุทุฃ: "Student number is required"

```
ุงูุณุจุจ: ุงูุทุงูุจ ูู ูุฏุฎู ุงูุฑูู ุงูุฌุงูุนู

ุงูุญู:
ุฃุฏุฎู ุงูุฑูู ุงูุฌุงูุนู ูู ุงูุญูู ุงููุฎุตุต
ูุซุงู: 443816488
```

---

## ๐ฏ **ุงููุชุทูุจุงุช:**

### โ **ูุจู ุงูุชุดุบูู:**

```bash
1. ุชุฃูุฏ ูู ุชุทุจูู Schema ูู Supabase
2. ุชุฃูุฏ ูู ุชุนุทูู Email Confirmation
3. ุชุฃูุฏ ูู ุตุญุฉ SUPABASE_URL ู ANON_KEY
```

### โ **ููุชุณุฌูู:**

```
โ ุจุฑูุฏ ุฌุงูุนู (@kku.edu.sa)
โ ูููุฉ ูุฑูุฑ (6 ุฃุญุฑู ุนูู ุงูุฃูู)
โ ุงุณู ูุงูู
โ ุงุฎุชูุงุฑ ุงูุฏูุฑ
โ ุฑูู ุฌุงูุนู (ููุทูุงุจ ููุท)
```

---

## ๐ **ุฌุฏูู profiles ูู Supabase:**

### ุงูุจููุฉ:

```sql
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  full_name TEXT NOT NULL,
  email TEXT NOT NULL,
  role TEXT NOT NULL CHECK (role IN ('student', 'teacher', 'supervisor')),
  student_number TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### ูุซุงู ุนูู ุงูุจูุงูุงุช:

```
id: 123e4567-e89b-12d3-a456-426614174000
full_name: ุฃุญูุฏ ูุญูุฏ
email: ahmed@kku.edu.sa
role: student
student_number: 443816488
created_at: 2025-01-15 10:30:00
```

---

## ๐ **ุงูุฎุทูุฉ ุงูุชุงููุฉ:**

### 1๏ธโฃ **ุชุทุจูู Schema:**

```bash
ุฑุงุฌุน: /DO-THIS-NOW.md
```

### 2๏ธโฃ **ุงุฎุชุจุงุฑ ุงููุธุงู:**

```bash
1. npm run dev
2. ุงูุชุญ: http://localhost:5173
3. ุณุฌู ุญุณุงุจ ุฌุฏูุฏ
4. ุณุฌู ุฏุฎูู
5. ุชุญูู ูู ููุญุฉ ุงูุชุญูู
```

### 3๏ธโฃ **ุชุนุฏูู ุงูุฃุฏูุงุฑ (ููุงุฎุชุจุงุฑ):**

```sql
-- ูู Supabase SQL Editor
UPDATE profiles 
SET role = 'teacher'  -- ุฃู 'supervisor' ุฃู 'student'
WHERE email = 'ahmed@kku.edu.sa';
```

---

## โ **ูุงุฆูุฉ ุงูุชุญูู:**

### ูุธุงู ุงูุชุณุฌูู:

- [x] ุฑุจุท ูุนูู ูุน Supabase Auth
- [x] ุงูุชุญูู ูู ุงูุจุฑูุฏ ุงูุฌุงูุนู (@kku.edu.sa)
- [x] ุงูุชุญูู ูู ุงูุฑูู ุงูุฌุงูุนู (ููุทูุงุจ)
- [x] ุญูุธ ุงูุจูุงูุงุช ูู ุฌุฏูู profiles
- [x] ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- [x] ุฏุนู ุงููุบุชูู (ุนุฑุจู/ุฅูุฌููุฒู)

### ูุธุงู ุชุณุฌูู ุงูุฏุฎูู:

- [x] ุชุณุฌูู ุฏุฎูู ูุนูู ูุน Supabase
- [x] ุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู ูู profiles
- [x] ุงูุชูุฌูู ุญุณุจ ุงูุฏูุฑ
- [x] ุญูุธ ุงูุฌูุณุฉ
- [x] ุงุณุชูุฑุงุฑ ุงูุฌูุณุฉ ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุญููู

### ุงูุชุญูู ุจุงููุตูู:

- [x] ุญูุงูุฉ ุงูุตูุญุงุช ุญุณุจ ุงูุฏูุฑ
- [x] ููุน ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจู
- [x] ุฑุณุงุฆู Access Denied ูุงุถุญุฉ
- [x] ุฅุนุงุฏุฉ ุชูุฌูู ุชููุงุฆูุฉ

---

<div align="center">

# โ **ุชู ุงูุชุญุฏูุซ ุจูุฌุงุญ!**

**ุงููุธุงู ุงูุขู ูุณุชุฎุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุญููููุฉ** ๐

---

## ๐ **ุฑูุงุจุท ูููุฏุฉ:**

### [โ๏ธ-FIX-THIS-FIRST.md](./โ๏ธ-FIX-THIS-FIRST.md) - ุญู ูุดุงูู Email

### [DO-THIS-NOW.md](./DO-THIS-NOW.md) - ุชุทุจูู Schema

### [๐ง-TROUBLESHOOTING.md](./๐ง-TROUBLESHOOTING.md) - ุญู ุฌููุน ุงููุดุงูู

---

**ุจุงูุชูููู!** ๐ฟ

</div>
