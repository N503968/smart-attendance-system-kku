# ุชุนูููุงุช ุงูุฅุนุฏุงุฏ ูุงูุฅุตูุงุญ | Setup Instructions

## ๐จ ุญู ุณุฑูุน ููุฎุทุฃ | Quick Fix

ุฅุฐุง ููุช ุชูุงุฌู ุฎุทุฃ:
```
Could not find a relationship between 'sessions' and 'sections'
```

### ุงูุฎุทูุงุช (ุจุงูุชุฑุชูุจ):

#### 1๏ธโฃ ุงูุชุญ Supabase Dashboard
- ุงุฐูุจ ุฅูู: https://supabase.com/dashboard
- ุงุฎุชุฑ ูุดุฑูุนู: `bscxhshnubkhngodruuj`
- ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุฎุชุฑ **SQL Editor**

#### 2๏ธโฃ ุชุดุบูู ุณูุฑุจุช ุงูุฅุตูุงุญ ุงูุนุงุฌู

ุงูุณุฎ ูุงูุตู ูุญุชูู ุงูููู `/URGENT-DATABASE-FIX.sql` ูู SQL Editor ูุงุถุบุท **Run**.

ูุฐุง ุงูุณูุฑุจุช ุณูููู ุจู:
- โ ุฅุถุงูุฉ ุงูุฃุนูุฏุฉ ุงูููููุฏุฉ (`starts_at`, `ends_at`, `require_webauthn`)
- โ ุงูุชุญูู ูู ูุฌูุฏ ุฌููุน ุงูุนูุงูุงุช (Foreign Keys)
- โ ุฅูุดุงุก ุงูู indexes ููุฃุฏุงุก ุงูุฃูุถู

#### 3๏ธโฃ (ุงุฎุชูุงุฑู) ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ

ุจุนุฏ ูุฌุงุญ ุงูุฎุทูุฉ ุงูุณุงุจูุฉุ ููููู ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ ููุงุฎุชุจุงุฑ:
- ุงูุณุฎ ูุงูุตู ูุญุชูู ุงูููู `/sample-data.sql`
- ุงุถุบุท **Run**

ูุฐุง ุณููุดุฆ:
- 5 ููุฑุฑุงุช ุฏุฑุงุณูุฉ
- 5 ุดุนุจ
- 7 ุฌุฏุงูู ุฒูููุฉ
- 3 ุฌูุณุงุช ูุดุทุฉ ููููู

---

## ๐ ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ | Fresh Setup

ุฅุฐุง ููุช ุชุจุฏุฃ ูู ุงูุตูุฑ:

### ุงูุฎุทูุฉ 1: ุชุดุบูู ุงูุณูููุง ุงููุงููุฉ
ุงูุณุฎ ูุงูุตู ูุญุชูู `/supabase-schema.sql` ูู SQL Editor.

### ุงูุฎุทูุฉ 2: ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ
ุงูุณุฎ ูุงูุตู ูุญุชูู `/sample-data.sql` ูู SQL Editor.

---

## ๐ ุงูุชุญูู ูู ุงููุฌุงุญ | Verify Success

### 1. ุงูุชุญูู ูู ุงูุฃุนูุฏุฉ
```sql
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'sessions';
```

ูุฌุจ ุฃู ุชุฑู:
- `id`
- `section_id`
- `date`
- `starts_at` โ **ููู**
- `ends_at` โ **ููู**
- `code`
- `is_active`
- `require_webauthn` โ **ููู**
- `created_at`
- `updated_at`

### 2. ุงูุชุญูู ูู ุงูุนูุงูุงุช
```sql
SELECT 
  tc.table_name, 
  tc.constraint_name, 
  kcu.column_name,
  ccu.table_name AS foreign_table_name
FROM information_schema.table_constraints AS tc 
JOIN information_schema.key_column_usage AS kcu
  ON tc.constraint_name = kcu.constraint_name
  AND tc.table_schema = kcu.table_schema
JOIN information_schema.constraint_column_usage AS ccu
  ON ccu.constraint_name = tc.constraint_name
  AND ccu.table_schema = tc.table_schema
WHERE tc.constraint_type = 'FOREIGN KEY' 
  AND tc.table_name IN ('sessions', 'sections', 'schedules')
ORDER BY tc.table_name;
```

ูุฌุจ ุฃู ุชุฑู:
- `sessions.section_id` โ `sections.id`
- `sections.course_id` โ `courses.id`
- `schedules.section_id` โ `sections.id`

### 3. ุงุฎุชุจุงุฑ ุงูู Query
```sql
SELECT 
  s.code,
  s.starts_at,
  sec.name as section_name,
  c.name as course_name
FROM sessions s
JOIN sections sec ON s.section_id = sec.id
JOIN courses c ON sec.course_id = c.id
LIMIT 5;
```

ุฅุฐุง ูุฌุญ ูุฐุง ุงูู query ุจุฏูู ุฃุฎุทุงุกุ ูุงูุฅุนุฏุงุฏ ุตุญูุญ! โ

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู | Testing

### 1. ุฅูุดุงุก ุญุณุงุจ ุทุงูุจ
- ุงุฐูุจ ููุชุทุจูู
- ุณุฌู ุญุณุงุจ ุฌุฏูุฏ
- ุงุณุชุฎุฏู ุจุฑูุฏ `@kku.edu.sa`
- ุงุฎุชุฑ ุฏูุฑ: **ุทุงูุจ**

### 2. ุงุฎุชุจุงุฑ ุงูุญุถูุฑ
- ุณุฌู ุฏุฎูู ูุทุงูุจ
- ุงุฐูุจ ูู "ุงูุฌูุณุงุช ุงููุดุทุฉ"
- ูุฌุจ ุฃู ุชุฑู ุงูุฌูุณุงุช ุงูุซูุงุซ ูู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ
- ุฌุฑุจ ุชุณุฌูู ุงูุญุถูุฑ ุจููุฏ: `DEF456`

### 3. ุฅูุดุงุก ุญุณุงุจ ูุฏุฑุณ (ุงุฎุชูุงุฑู)
- ุณุฌู ุญุณุงุจ ุฌุฏูุฏ
- ุงุณุชุฎุฏู ุจุฑูุฏ `@kku.edu.sa`
- ุงุฎุชุฑ ุฏูุฑ: **ูุฏุฑุณ**
- ููููู ุฑุจุท ุงููุฏุฑุณ ุจุดุนุจุฉ:
```sql
UPDATE sections 
SET instructor_id = 'USER_ID_HERE' 
WHERE id = 'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa';
```

---

## ๐ ูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช | Database Files

| ุงูููู | ุงูุงุณุชุฎุฏุงู |
|------|----------|
| `/supabase-schema.sql` | ุงูุณูููุง ุงููุงููุฉ ูููุงุนุฏุฉ (ููุฅุนุฏุงุฏ ุงูุฌุฏูุฏ) |
| `/URGENT-DATABASE-FIX.sql` | **ุงุจุฏุฃ ูู ููุง!** ุฅุตูุงุญ ุณุฑูุน ูููุดููุฉ ุงูุญุงููุฉ |
| `/supabase-schema-update.sql` | ุชุญุฏูุซ ุงููุงุนุฏุฉ ุงูููุฌูุฏุฉ (ุจุฏูู ููู URGENT) |
| `/sample-data.sql` | ุจูุงูุงุช ุชุฌุฑูุจูุฉ ููุงุฎุชุจุงุฑ |

---

## โ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก | Troubleshooting

### ุงูุฎุทุฃ: "sessions table does not exist"
**ุงูุญู:** ูู ุจุชุดุบูู `/supabase-schema.sql` ุฃููุงู ูุฅูุดุงุก ุฌููุน ุงูุฌุฏุงูู.

### ุงูุฎุทุฃ: "Could not find relationship"
**ุงูุญู:** 
1. ูู ุจุชุดุบูู `/URGENT-DATABASE-FIX.sql`
2. ุชุญูู ูู ูุฌูุฏ ุงูู Foreign Keys
3. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ

### ุงูุฎุทุฃ: "No active sessions"
**ุงูุญู:** ูู ุจุชุดุบูู `/sample-data.sql` ูุฅุถุงูุฉ ุฌูุณุงุช ุชุฌุฑูุจูุฉ.

### ูุง ุชุธูุฑ ุจูุงูุงุช ุงูุญุถูุฑ
**ุงูุญู:**
1. ุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ุจุญุณุงุจ ุทุงูุจ
2. ุชุญูู ูู ูุฌูุฏ ุณุฌูุงุช ุญุถูุฑ ูู ุฌุฏูู `attendance`
3. ุงูุญุต Console ูู ุงููุชุตูุญ ููุฃุฎุทุงุก

---

## ๐ Row Level Security (RLS)

ุงูุณูููุง ุชุชุถูู ุณูุงุณุงุช RLS ูุงููุฉ:
- โ ุงูุทูุงุจ ูุฑูู ุญุถูุฑูู ููุท
- โ ุงููุฏุฑุณูู ูุฑูู ุจูุงูุงุช ุดุนุจูู ููุท
- โ ุงููุดุฑููู ูุฑูู ุฌููุน ุงูุจูุงูุงุช
- โ ุญูุงูุฉ ุถุฏ ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจู

---

## ๐ ุงูุฏุนู | Support

ุฅุฐุง ุงุณุชูุฑุช ุงููุดุงูู:
1. ุชุญูู ูู Browser Console (F12)
2. ุชุญูู ูู Supabase Logs
3. ุชุฃูุฏ ูู ุตุญุฉ Project ID: `bscxhshnubkhngodruuj`
4. ุชุฃูุฏ ูู ุตุญุฉ ูุชุบูุฑุงุช ุงูุจูุฆุฉ ูู ุงูุชุทุจูู

---

## โ ูุงุฆูุฉ ุงูุชุญูู | Checklist

ูุจู ุงูุจุฏุก ูู ุงุณุชุฎุฏุงู ุงููุธุงูุ ุชุฃูุฏ ูู:

- [ ] ุชุดุบูู `/URGENT-DATABASE-FIX.sql` ุจูุฌุงุญ
- [ ] ุฌููุน ุงูุฃุนูุฏุฉ ููุฌูุฏุฉ ูู ุฌุฏูู `sessions`
- [ ] ุงูุนูุงูุงุช (Foreign Keys) ููุฌูุฏุฉ ูุตุญูุญุฉ
- [ ] (ุงุฎุชูุงุฑู) ุชุดุบูู `/sample-data.sql` ููุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ
- [ ] ุฅูุดุงุก ุญุณุงุจ ุทุงูุจ ููุงุฎุชุจุงุฑ
- [ ] ุชุณุฌูู ุงูุฏุฎูู ูุงููุตูู ูููุญุฉ ุงูุชุญูู ุจุฏูู ุฃุฎุทุงุก
- [ ] ุธููุฑ ุงูุฌูุณุงุช ุงููุดุทุฉ (ุฅุฐุง ุชู ุฅุถุงูุฉ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ)

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2024-11-10
